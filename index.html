<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KOV - Field Objects Update</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.19 | MIT License | https://tailwindcss.com*/*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}
/* ... (기존 스타일 유지) ... */
* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

body {
    background-color: #000;
    touch-action: none;
    font-family: 'Segoe UI', sans-serif;
    overflow: hidden;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100vw;
    height: 100dvh;
}

#game-container {
    position: relative;
    background-color: #4e342e;
    box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
    width: 100%;
    min-height: 22px;
    height: 100%;
    max-width: 56.25vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Header */
.header-panel {
    flex: 0 0 auto;
    background: linear-gradient(to bottom, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.0));
    color: white;
    padding: 6px 8px;
    /* Reduced padding */
    padding-top: max(6px, env(safe-area-inset-top));
    z-index: 20;
    overflow-x: auto;
    /* Allow scroll if needed, or hidden */
    scrollbar-width: none;
    /* Hide scrollbar */
}

.res-pill {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid #555;
    border-radius: 99px;
    padding: 2px 8px;
    /* Reduced padding */
    display: flex;
    align-items: center;
    gap: 4px;
    /* Reduced gap */
    font-weight: bold;
    font-size: 11px;
    /* Reduced font size */
    color: #fff;
    cursor: pointer;
    transition: transform 0.1s;
    white-space: nowrap;
    /* Prevent wrapping */
}

.res-pill:active {
    transform: scale(0.95);
    background: rgba(255, 255, 255, 0.1);
}

.res-icon {
    width: 18px;
    height: 18px;
    object-fit: contain;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* Canvas */
#canvas-wrapper {
    flex: 1;
    position: relative;
    overflow: hidden;
    background-color: #3e2723;
    width: 100%;
    min-height: 22px;
}

canvas {
    display: block;
    width: 100%;
    min-height: 22px;
    height: 100%;
    image-rendering: pixelated;
}

/* Footer */
.footer-panel {
    flex: 0 0 auto;
    background: #d7ccc8;
    border-top: 4px solid #8d6e63;
    padding: 8px 12px;
    padding-bottom: max(10px, env(safe-area-inset-bottom));
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 90px;
    z-index: 20;
}

.info-box {
    flex: 1;
    background: #f5f5f5;
    border: 1px solid #8d6e63;
    border-radius: 6px;
    padding: 4px 8px;
    height: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    color: #3e2723;
    margin: 0 6px;
    overflow: hidden;
    color: #3e2723;
    margin: 0 6px;
    overflow: hidden;
    display: none;
    /* Force hidden by default */
}

.modal-overlay.open {
    display: flex;
}

.stat-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2px;
    font-size: 10px;
    font-weight: bold;
    color: #444;
    margin-top: 2px;
}

/* Action Buttons */
.action-btn {
    width: 56px;
    height: 56px;
    background: linear-gradient(to bottom, #ffca28, #ff6f00);
    border: 1px solid #e65100;
    border-radius: 10px;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 0 #bf360c, 0 5px 5px rgba(0, 0, 0, 0.3);
    transition: all 0.1s;
    position: relative;
    padding-bottom: 2px;
}

.action-btn:active {
    transform: translateY(3px);
    box-shadow: 0 0 0 #bf360c, 0 0 0 rgba(0, 0, 0, 0);
    border-bottom-width: 0;
}

.world-btn {
    background: linear-gradient(to bottom, #42a5f5, #1565c0);
    border-color: #0d47a1;
    box-shadow: 0 3px 0 #0d47a1, 0 5px 5px rgba(0, 0, 0, 0.3);
}

.world-btn:active {
    box-shadow: 0 0 0 #0d47a1;
}

.build-btn {
    background: linear-gradient(to bottom, #8d6e63, #5d4037);
    border-color: #3e2723;
    box-shadow: 0 3px 0 #3e2723, 0 5px 5px rgba(0, 0, 0, 0.3);
}

.build-btn:active {
    box-shadow: 0 0 0 #3e2723;
}

.btn-icon {
    font-size: 22px;
    line-height: 1;
    margin-bottom: 2px;
    filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2));
}

.btn-label {
    font-size: 11px;
    font-weight: bold;
    line-height: 1;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.4);
    letter-spacing: -0.5px;
}

/* Modals & Popups */
.modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    backdrop-filter: blur(2px);
}

.modal-overlay.open {
    opacity: 1;
    pointer-events: auto;
}

.modal-content {
    background: #3e2723;
    border: 2px solid #8d6e63;
    border-radius: 12px;
    padding: 20px;
    width: 85%;
    max-width: 320px;
    text-align: center;
    color: white;
    transform: scale(0.9);
    transition: transform 0.2s;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
}

.modal-overlay.open .modal-content {
    transform: scale(1);
}

.modal-content.wide {
    max-width: 360px;
}

.close-modal {
    position: absolute;
    top: 10px;
    right: 15px;
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
    z-index: 10;
}

.close-modal:hover {
    color: #fff;
}

#field-modal {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    min-height: 22px;
    height: 100%;
    background: #222;
    z-index: 90;
    transform: translateY(100%);
    transition: transform 0.3s ease-out;
    display: none;
    flex-direction: column;
    color: white;
    pointer-events: none;
}

#field-modal.open {
    display: flex;
    transform: translateY(0);
    pointer-events: auto;
}

.shop-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    overflow-y: auto;
    padding: 10px;
}

.shop-item {
    background: #4e342e;
    border: 2px solid #8d6e63;
    border-radius: 10px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.toggle-switch {
    width: 40px;
    height: 20px;
    background: #555;
    border-radius: 20px;
    position: relative;
    transition: 0.3s;
}

.toggle-switch.on {
    background: #4caf50;
}

.toggle-knob {
    width: 16px;
    height: 16px;
    background: #fff;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: 0.3s;
}

.toggle-switch.on .toggle-knob {
    left: 22px;
}

:root {
    --cloud-img: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc2NCcgaGVpZ2h0PSc2NCcgdmlld0JveD0nMCAwIDY0IDY0Jz48ZyBmaWxsPScjZjhmOGY4Jz48ZWxsaXBzZSBjeD0nMTgnIGN5PSczNicgcng9JzE4JyByeT0nMTInLz48ZWxsaXBzZSBjeD0nMzInIGN5PScyNicgcng9JzIyJyByeT0nMTQnLz48ZWxsaXBzZSBjeD0nNDgnIGN5PSczNCcgcng9JzE4JyByeT0nMTInLz48cmVjdCB4PSc2JyB5PSczMCcgd2lkdGg9JzUyJyBoZWlnaHQ9JzIyJyByeD0nMTEnLz48L2c+PGcgZmlsbD0nI2VkZWRlZCc+PGVsbGlwc2UgY3g9JzI0JyBjeT0nNDAnIHJ4PScxNicgcnk9JzEwJy8+PGVsbGlwc2UgY3g9JzQwJyBjeT0nMzgnIHJ4PScxNicgcnk9JzEwJy8+PC9nPjwvc3ZnPg==");
}

/* Field Styles */
.field-cell {
    width: 12px;
    height: 12px;
    transition: all 0.2s;
    border-radius: 1px;
    position: relative;
    z-index: 10;
    overflow: hidden;
}

.field-occupied {
    border: 1px solid #42a5f5;
    box-shadow: 0 0 2px #42a5f5;
    z-index: 10;
    opacity: 1.0 !important;
}

.field-target {
    outline: 1px solid #ffd700;
    box-shadow: 0 0 4px #ffd700;
    z-index: 15;
}

.field-selected {
    outline: 2px solid #22d3ee;
    box-shadow: 0 0 6px rgba(34, 211, 238, 0.9);
    z-index: 16;
}

.field-path {
    outline: 1px solid rgba(255, 255, 255, 0.5);
    background: rgba(255, 255, 255, 0.08);
    z-index: 12;
}

.field-wall {
    background-color: #8b5a3c !important;
    background-image:
        linear-gradient(0deg, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.12)),
        repeating-linear-gradient(90deg, rgba(0, 0, 0, 0.18) 0 1px, transparent 1px 6px),
        repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.18) 0 1px, transparent 1px 6px),
        repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.12) 0 1px, transparent 1px 12px);
    background-size: 100% 100%, 6px 6px, 6px 6px, 12px 12px;
    background-position: 0 0, 0 0, 0 0, 3px 3px;
    border: 1px solid rgba(0, 0, 0, 0.25);
    box-shadow: inset 0 0 1px rgba(0, 0, 0, 0.35);
}

.field-wall::after {
    content: '🧱';
    font-size: 9px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.45;
    filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.45));
}

#path-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 15;
}

.path-line-bg {
    stroke: rgba(0, 0, 0, 0.6);
    stroke-width: 4;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.path-line {
    stroke: #ffd700;
    stroke-width: 2;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.field-badge {
    position: absolute;
    left: 50%;
    bottom: 0;
    transform: translate(-50%, 1px);
    padding: 0 1px;
    border-radius: 2px;
    font-size: 3px;
    font-weight: 700;
    line-height: 1;
    letter-spacing: -0.2px;
    color: #f8fafc;
    background: rgba(0, 0, 0, 0.2);
    z-index: 18;
    opacity: 0.4;
    pointer-events: none;
}

.field-badge.active {
    color: #d1fae5;
    background: rgba(34, 197, 94, 0.25);
}

.field-badge.inactive {
    color: #fee2e2;
    background: rgba(239, 68, 68, 0.2);
}

/* Field event: large sprite + small bottom label */
.event-marker {
    position: absolute;
    inset: 0;
    z-index: 19;
    pointer-events: none;
}

.event-marker .evt-sprite {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 10px;
    height: 10px;
    transform: translate(-50%, -55%);
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    border-radius: 2px;
    filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.55));
    opacity: 0.96;
}

.event-marker .evt-label {
    position: absolute;
    left: 50%;
    bottom: 0;
    transform: translate(-50%, 1px);
    padding: 0 1px;
    border-radius: 2px;
    font-size: 3px;
    font-weight: 700;
    line-height: 1;
    letter-spacing: -0.2px;
    color: var(--event-color, #f1f5f9);
    background: rgba(0, 0, 0, 0.2);
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.75);
    opacity: 0.7;
}

.event-marker-bandit {
    --event-color: #fecaca;
}

.event-marker-leader {
    --event-color: #fdba74;
}

.event-marker-dungeon {
    --event-color: #ddd6fe;
}

.event-marker-portal {
    --event-color: #a5f3fc;
}

.event-marker-caravan {
    --event-color: #fde68a;
}

.field-time {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(4px, 0.5vw, 6px);
    font-weight: 700;
    color: #ffe08a;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.75);
    pointer-events: none;
    letter-spacing: -0.35px;
    z-index: 25;
    line-height: 1;
    opacity: 0.5;
    transform: translateY(var(--label-offset, -1px)) scale(var(--label-scale, 1));
    transform-origin: center bottom;
}

.field-time.lower {
    --label-offset: 0px;
}

.field-cell::after {
    z-index: 12;
}

.field-move-eligible {
    outline: 1px dashed rgba(255, 255, 255, 0.35);
}

.field-move-source {
    outline: 1px solid #4ade80;
    box-shadow: 0 0 4px rgba(74, 222, 128, 0.9);
}

/* --- Phase 4: Social & BM Styles --- */

/* Header Profile */
.header-profile {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 48px;
    height: 48px;
    background: #2a2a2a;
    border: 2px solid #fbbf24;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
}

.header-profile .avatar {
    font-size: 28px;
}

.header-profile .level-badge {
    position: absolute;
    bottom: -6px;
    right: -6px;
    background: #dc2626;
    color: white;
    font-size: 10px;
    font-weight: bold;
    padding: 2px 5px;
    border-radius: 99px;
    border: 1px solid white;
}

/* Adjust Header Padding for Profile */
.header-panel {
    padding-left: 65px;
    position: relative;
}

/* Chat Floating Button */
.chat-float-btn {
    position: absolute;
    bottom: 110px;
    left: 16px;
    right: auto;
    width: 48px;
    height: 48px;
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid #60a5fa;
    border-radius: 50%;
    color: white;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 90;
    backdrop-filter: blur(4px);
    transition: transform 0.2s;
}

.chat-float-btn:active {
    transform: scale(0.9);
}

/* Chat Drawer */
.chat-drawer {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 45%;
    background: rgba(17, 24, 39, 0.95);
    border-top: 2px solid #4b5563;
    z-index: 100;
    display: flex;
    flex-direction: column;
    transform: translateY(110%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
}

.chat-drawer.open {
    transform: translateY(0);
}

.chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 16px;
    background: #1f2937;
    border-bottom: 1px solid #374151;
    font-weight: bold;
    color: #e5e7eb;
}

.chat-tabs {
    display: flex;
    background: #111827;
}

.chat-tabs button {
    flex: 1;
    padding: 10px;
    background: transparent;
    color: #9ca3af;
    border: none;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
}

.chat-tabs button.active {
    color: #60a5fa;
    border-bottom-color: #60a5fa;
    background: rgba(96, 165, 250, 0.1);
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.chat-line {
    font-size: 13px;
    color: #ffffff !important;
    line-height: 1.4;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
}

.chat-line .sender {
    color: #fbbf24;
    font-weight: bold;
    margin-right: 4px;
}

.chat-line.me {
    text-align: right;
}

.chat-line.me .sender {
    display: none;
}

.chat-line.me .text {
    background: #1e40af;
    color: white;
    padding: 4px 10px;
    border-radius: 12px 12px 0 12px;
    display: inline-block;
}

.chat-input-area {
    padding: 10px;
    background: #1f2937;
    display: flex;
    gap: 8px;
}

.chat-input-area input {
    flex: 1;
    background: #374151;
    border: 1px solid #4b5563;
    border-radius: 4px;
    color: white;
    padding: 8px;
}

.chat-input-area button {
    padding: 8px 16px;
    background: #2563eb;
    color: white;
    border-radius: 4px;
    font-weight: bold;
}

/* Profile View */
.profile-view {
    padding: 20px;
    text-align: center;
}

.profile-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-bottom: 24px;
}

.profile-avatar-lg {
    width: 80px;
    height: 80px;
    background: #2a2a2a;
    border: 3px solid #fbbf24;
    border-radius: 16px;
    font-size: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.profile-info h3 {
    margin: 0;
    font-size: 20px;
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
}

.profile-info p {
    margin: 4px 0 0;
    color: #9ca3af;
    font-size: 14px;
}

.edit-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
}

.profile-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 24px;
}

.stat-box {
    background: #374151;
    padding: 12px;
    border-radius: 8px;
}

.stat-box div {
    color: #9ca3af;
    font-size: 12px;
    margin-bottom: 4px;
}

.stat-box span {
    color: #fbbf24;
    font-size: 18px;
    font-weight: bold;
}

.profile-actions {
    display: flex;
    gap: 10px;
}

.btn-action {
    flex: 1;
    padding: 12px;
    background: #4b5563;
    color: white;
    border-radius: 8px;
    font-weight: bold;
}

.shop-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 10px;
    padding: 0 5px;
}

.shop-tab {
    flex: 1;
    padding: 8px;
    background: #374151;
    color: #9ca3af;
    border-radius: 6px;
    font-size: 12px;
}

.shop-tab.active {
    background: #fbbf24;
    color: #111827;
    font-weight: bold;
}

/* Fog of War */
.field-fog {
    background-color: #0b0b0b !important;
    border: none;
    cursor: default;
    z-index: 100;
    opacity: 1 !important;
}

.field-cloud-blocked {
    z-index: 14;
    background-color: transparent;
}

.field-cloud-layer {
    position: absolute;
    inset: 0;
    background-image: var(--cloud-img);
    background-repeat: no-repeat;
    background-size: 100% 100%;
    background-position: center;
    pointer-events: none;
    z-index: 30;
    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.25));
}

.field-bottom-bar {
    position: absolute;
    left: 8px;
    right: 8px;
    bottom: 8px;
    background: rgba(15, 15, 15, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 10px;
    padding: 4px 6px;
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 80;
    pointer-events: auto;
    max-height: 30vh;
    overflow: hidden;
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
    backdrop-filter: blur(2px);
}

.field-bottom-icon {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #f8fafc;
    flex: 0 0 auto;
    overflow: hidden;
}

.field-bottom-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.field-bottom-center {
    display: flex;
    flex-direction: column;
    min-width: 0;
    flex: 1;
    gap: 4px;
}

.field-bottom-name {
    font-size: clamp(12px, 2.2vw, 14px);
    color: #f8fafc;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.field-bottom-title {
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 0;
}

.field-bottom-details {
    display: flex;
    flex-direction: column;
    gap: 3px;
    font-size: clamp(9px, 1.2vw, 11px);
    color: #e5e7eb;
    max-height: 14vh;
    overflow: hidden;
    padding-right: 0;
    line-height: 1.2;
}

.field-bottom-columns {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    gap: 6px;
    align-items: start;
}

.field-bottom-col {
    display: flex;
    flex-direction: column;
    gap: 3px;
    min-width: 0;
}

.field-bottom-owner-row {
    margin-top: auto;
}

.field-bottom-effect-row {
    margin-top: auto;
}

.field-bottom-single {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
}

.field-bottom-subtitle {
    font-size: clamp(9px, 1.1vw, 10px);
    color: #fbbf24;
    font-weight: 700;
    letter-spacing: -0.2px;
}

.field-bottom-summary {
    font-size: clamp(11px, 1.6vw, 13px);
    color: #f8fafc;
    font-weight: 600;
}

.field-bottom-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.08);
    margin: 2px 0;
}

.field-bottom-details .field-info-row {
    font-size: inherit;
}

.field-bottom-details .field-info-small {
    font-size: clamp(9px, 1.2vw, 11px);
    color: #9ca3af;
    width: 100%;
    min-height: 22px;
}

.field-bottom-bar .field-info-row {
    display: grid;
    grid-template-columns: minmax(52px, 80px) 1fr;
    align-items: center;
    gap: 4px;
    justify-content: start;
}

.field-bottom-bar .field-info-row span {
    text-align: left;
}

.field-bottom-bar .field-info-row span:first-child {
    color: #a7b0c8;
}

.field-bottom-bar .field-info-row span:last-child {
    color: #e5e7eb;
}

.field-bottom-bar .field-info-small {
    color: #94a3b8;
}

.field-footer-btn {
    width: 44px;
    height: 44px;
    padding-bottom: 0;
}

.field-footer-btn .btn-icon {
    font-size: 18px;
    margin-bottom: 0;
}

.field-footer-btn .btn-label {
    font-size: 9px;
}

@media (max-width: 360px) {
    .field-bottom-bar {
        bottom: 8px;
        padding: 9px 10px;
        max-height: 42vh;
    }
}

/* Object Icons */
.field-gate {
    border: 1px solid #ef4444;
}

.field-gate.locked::after {
    content: '🔒';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-gate.unlocked::after {
    content: '👐';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-castle::after {
    content: '🏰';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-fortress::after {
    content: '🏯';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-citadel::after {
    content: '🏯';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-dragon::after {
    content: '🐉';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-shop::after {
    content: '🛒';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-tavern::after {
    content: '🍺';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-ruins::after {
    content: '🏛️';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-statue::after {
    content: '🗿';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* New Objects: Gold Mine & Fountain */
.field-goldmine::after {
    content: '⛏️';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-fountain::after {
    content: '⛲';
    font-size: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.field-move-info {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 11px;
    color: #f8fafc;
    display: flex;
    justify-content: space-between;
    gap: 6px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.35);
}

.field-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 60;
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 6px 8px 0;
    pointer-events: none;
}

.field-overlay>* {
    pointer-events: auto;
}

.field-squad-tabs {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.field-squad-tab {
    background: rgba(15, 15, 15, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e5e7eb;
    border-radius: 8px;
    padding: 4px 8px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: -0.2px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.field-squad-tab.active {
    background: rgba(34, 197, 94, 0.25);
    border-color: #4ade80;
    color: #f0fdf4;
    box-shadow: 0 0 0 1px rgba(74, 222, 128, 0.4);
}

.field-squad-tab:active {
    transform: scale(0.97);
}

.field-effect-log {
    background: rgba(0, 0, 0, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 10px;
    color: #e5e7eb;
    display: none;
    flex-direction: column;
    gap: 2px;
    width: min(240px, 78vw);
}

.field-effect-log .title {
    font-weight: bold;
    color: #fbbf24;
    font-size: 10px;
}

.field-effect-log .entry {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.field-floating-wrap {
    position: relative;
    z-index: 70;
    display: none;
    flex-direction: column;
    gap: 6px;
    width: min(240px, 78vw);
    pointer-events: auto;
    align-self: flex-start;
}

.field-info-panel {
    background: rgba(20, 20, 20, 0.94);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 8px;
    padding: 8px 10px;
    margin-bottom: 0;
    font-size: 12px;
    color: #fff;
    transform: translateY(6px) scale(0.98);
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: transform 0.2s ease, opacity 0.2s ease, max-height 0.2s ease;
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
}

.field-info-panel.open {
    transform: translateY(0) scale(1);
    opacity: 1;
    max-height: 240px;
}

.field-info-title {
    font-weight: bold;
    color: #ffd700;
    font-size: 13px;
    margin-bottom: 4px;
}

.field-info-row {
    display: flex;
    justify-content: space-between;
    gap: 8px;
}

.field-info-small {
    font-size: 11px;
    color: #ccc;
    margin-top: 4px;
}

.field-action-btn.disabled {
    opacity: 0.5;
}

.field-info-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 2px;
}

.field-info-bar-fill {
    height: 100%;
    background: #fbbf24;
}

.shop-list {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 8px;
}

.shop-card {
    background: #2b2b2b;
    border: 1px solid #4b4b4b;
    border-radius: 10px;
    padding: 8px;
    text-align: left;
    font-size: 11px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-height: 92px;
}

.shop-card .name {
    font-weight: bold;
    color: #f8fafc;
}

.shop-card .meta {
    color: #cbd5f5;
    font-size: 10px;
    min-height: 18px;
}

.shop-card .level {
    color: #94a3b8;
    font-size: 10px;
}

.shop-card .price-btn {
    align-self: stretch;
    background: #f59e0b;
    color: #111827;
    border-radius: 8px;
    padding: 6px 0;
    font-weight: bold;
    font-size: 11px;
    margin-top: auto;
}

.shop-card .price-btn:active {
    transform: scale(0.98);
}

.shop-card.disabled {
    opacity: 0.45;
}

.shop-card.disabled .price-btn {
    background: #374151;
    color: #9ca3af;
}

.shop-icon {
    width: 26px;
    height: 26px;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.shop-icon-img {
    width: 100%;
    min-height: 22px;
    height: 100%;
    object-fit: contain;
}

.shop-row {
    display: flex;
    align-items: center;
    gap: 6px;
}

.shop-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.shop-title {
    font-weight: bold;
    color: #f8fafc;
}

.shop-refresh {
    color: #9ca3af;
    font-size: 10px;
}

.shop-card.restock {
    animation: restockPulse 0.8s ease-out;
    box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.6);
}

@keyframes restockPulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.0);
    }

    50% {
        transform: scale(1.03);
        box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.5);
    }

    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.0);
    }
}

.field-action-menu {
    position: absolute;
    background: rgba(15, 15, 15, 0.95);
    border: 1px solid #666;
    border-radius: 8px;
    padding: 6px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 120;
    min-width: 90px;
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.5);
}

.field-action-btn {
    background: #2f2f2f;
    border: 1px solid #555;
    color: #fff;
    padding: 6px 8px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
}

.field-action-btn:active {
    transform: scale(0.97);
}

#income-float {
    position: absolute;
    color: #ffd700;
    font-weight: bold;
    font-size: 12px;
    pointer-events: none;
    animation: floatUp 1s forwards;
    z-index: 200;
    text-shadow: 1px 1px 0 #000;
}

@keyframes floatUp {
    0% {
        transform: translateY(0);
        opacity: 1;
    }

    100% {
        transform: translateY(-20px);
        opacity: 0;
    }
}

.join-float {
    position: absolute;
    left: 50%;
    bottom: 18%;
    transform: translateX(-50%);
    color: #4ade80;
    font-weight: bold;
    font-size: 12px;
    pointer-events: none;
    animation: floatUp 1s forwards;
    z-index: 220;
    text-shadow: 1px 1px 0 #000;
}

#toast {
    position: absolute;
    top: 20%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 200;
    border: 2px solid #ffd700;
    white-space: nowrap;
    pointer-events: none;
}

/* Army Marker */
.army-marker {
    position: absolute;
    width: 12px;
    height: 12px;
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
    transition: transform 0.1s linear;
    z-index: 50;
    pointer-events: none;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 8px;
    font-weight: bold;
    color: black;
    overflow: visible;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}

.army-marker.selected {
    box-shadow: 0 0 15px 2px #ffd700;
    transform: scale(1.3);
    z-index: 51;
}

#levelup-banner {
    position: absolute;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    z-index: 150;
    pointer-events: none;
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#levelup-banner.show {
    transform: translate(-50%, -50%) scale(1);
}

.levelup-stat {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 5px;
}

.levelup-old {
    color: #aaa;
}

.levelup-arrow {
    color: #fbbf24;
    margin: 0 10px;
}

.levelup-new {
    color: #4ade80;
    font-weight: bold;
}

/* Battle System Styles */
#modal-battle .modal-content {
    max-width: 400px;
    padding: 10px;
}

.battle-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.battle-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
    margin-bottom: 5px;
}

.battle-stage {
    position: relative;
    width: 100%;
    height: 200px;
    background: #222;
    border: 1px solid #444;
    border-radius: 6px;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
}

.battle-stage.active {
    background: #331111;
}

.battle-log {
    height: 80px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.5);
    font-size: 10px;
    text-align: left;
    padding: 5px;
    border-top: 1px solid #444;
    width: 100%;
}

.battle-grid-check {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 4px;
    margin: 10px auto;
    width: 140px;
}

.battle-cell {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px dashed #666;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    position: relative;
}

.battle-cell.enemy {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
}

.battle-cell.ally {
    border-color: #3b82f6;
    background: rgba(59, 130, 246, 0.1);
}

.battle-unit {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.battle-hp-bar {
    width: 90%;
    height: 4px;
    background: #444;
    margin-top: 2px;
    border-radius: 2px;
    overflow: hidden;
}

.battle-hp-fill {
    height: 100%;
    background: #ef4444;
}

.battle-cell.ally .battle-hp-fill {
    background: #3b82f6;
}

.battle-result-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 50;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

.battle-result-text {
    font-size: 32px;
    font-weight: bold;
    text-shadow: 0 0 10px currentColor;
}

.battle-result-text.win {
    color: #ffd700;
}

.battle-result-text.lose {
    color: #ef4444;
}

.battle-controls {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.battle-btn {
    padding: 8px 20px;
    border-radius: 6px;
    font-weight: bold;
    font-size: 12px;
    cursor: pointer;
    border: none;
}

.battle-btn.start {
    background: #ef4444;
    color: white;
}

.battle-btn.close {
    background: #444;
    color: #ccc;
}

/* Battle Prep Styles */
.battle-cell.prep {
    cursor: grab;
    border-style: solid;
    background: rgba(255, 255, 255, 0.1);
}

.battle-cell.prep:active {
    cursor: grabbing;
}

.battle-cell.prep.empty {
    border: 1px dashed #555;
    background: rgba(0, 0, 0, 0.2);
}

.battle-cell.prep.ally:hover {
    border-color: #ffd700;
    background: rgba(255, 255, 255, 0.15);
}

/* Enemy prep cells are static */
.battle-cell.prep.enemy {
    cursor: default;
    opacity: 0.8;
}
</style>
</head>

<body>

    <div id="game-container">
        <div id="levelup-banner"><img src="https://raw.githubusercontent.com/nod-sean/bmo/main/img/levelup.png"
                onerror="this.style.display='none'"></div>

        <!-- Header -->
        <div class="header-panel">
            <div class="flex justify-between mb-1">
                <div class="res-pill" onclick="game.openRefill('energy')">
                    <img src="https://raw.githubusercontent.com/nod-sean/bmo/main/img/energy.png" class="res-icon"
                        onerror="this.style.display='none';this.nextElementSibling.innerText='⚡'+this.nextElementSibling.innerText">
                    <span id="energy-display">50/50</span>
                    <span class="text-gray-400 text-[10px] ml-1">+</span>
                </div>
                <div class="res-pill" onclick="game.openRefill('cp')">
                    <span class="res-icon">🧭</span>
                    <span id="cp-display">20/20</span>
                    <span class="text-gray-400 text-[10px] ml-1">+</span>
                </div>
                <div class="res-pill" onclick="game.openRefill('gold')">
                    <img src="https://raw.githubusercontent.com/nod-sean/bmo/main/img/gold.png" class="res-icon"
                        onerror="this.style.display='none';this.nextElementSibling.innerText='💰'+this.nextElementSibling.innerText">
                    <span id="gold-display">3000</span>
                    <span class="text-gray-400 text-[10px] ml-1">+</span>
                </div>
                <div class="res-pill" onclick="game.openRefill('crystal')">
                    <img src="https://raw.githubusercontent.com/nod-sean/bmo/main/img/crystal.png" class="res-icon"
                        onerror="this.style.display='none';this.nextElementSibling.innerText='💎'+this.nextElementSibling.innerText">
                    <span id="gem-display">50</span>
                    <span class="text-gray-400 text-[10px] ml-1">+</span>
                </div>
            </div>
            <div class="flex flex-col w-full">
                <div class="flex justify-between items-end px-1">
                    <span class="font-bold text-yellow-400 text-xs" id="level-display">LORD LV.1</span>
                    <span class="font-bold text-gray-300 text-xs flex items-center gap-1"><span id="xp-text">0 /
                            10</span> XP</span>
                </div>
                <div class="w-full bg-gray-800 h-2 mt-1 rounded-full overflow-hidden border border-gray-600 relative">
                    <div id="xp-bar" class="h-full bg-blue-500 w-0 transition-all duration-300"></div>
                </div>
            </div>
            <!-- Dev Tools -->
            <!-- Dev Tools -->
            <div class="flex gap-2 mt-1 opacity-30 hover:opacity-100 transition-opacity justify-end items-center"
                style="display:none;">
                <button onclick="game.resetGame()"
                    class="bg-red-800 text-white px-2 py-1 rounded text-[10px] border border-red-500 hover:bg-red-600">🔄리셋</button>
                <button onclick="game.cheatEnergy()"
                    class="bg-gray-700 text-white px-2 py-1 rounded text-[10px]">⚡+30</button>
                <button onclick="game.spawnChest()"
                    class="bg-gray-700 text-white px-2 py-1 rounded text-[10px]">🎁상자</button>
                <button onclick="game.cheatLevelUp()"
                    class="bg-gray-700 text-white px-2 py-1 rounded text-[10px]">⬆️LvUP</button>
            </div>
        </div>

        <!-- Main Canvas -->
        <div id="canvas-wrapper">
            <canvas id="gameCanvas"></canvas>
        </div>

        <!-- Footer -->
        <div class="footer-panel">
            <button class="action-btn chat-btn bg-gray-700 border-gray-600" id="chat-btn" onclick="game.toggleChat()">
                <span class="text-2xl filter drop-shadow">💬</span>
            </button>
            <div class="info-box" id="info-panel">
                <div class="flex justify-between items-center"><span class="font-bold text-sm truncate"
                        id="info-name">선택 없음</span><span class="text-[10px] text-gray-500 font-bold"
                        id="info-class"></span></div>
                <div class="stat-grid hidden" id="unit-stats-grid">
                    <div class="stat-item">❤<span id="st-hp">0</span></div>
                    <div class="stat-item">⚔<span id="st-atk">0</span></div>
                    <div class="stat-item">🛡️<span id="st-def">0</span></div>
                    <div class="stat-item">🦶<span id="st-spd">0</span></div>
                    <div class="stat-item">🎯<span id="st-rng">0</span></div>
                    <div class="stat-item">🏃<span id="st-mov">0</span></div>
                </div>
                <div class="text-[10px] text-gray-600 truncate mt-1" id="info-desc">오브젝트를 선택하세요.</div>
            </div>

            <button class="action-btn" id="btn-action" onclick="game.handleAction()">
                <span class="btn-icon" id="action-icon">💰</span>
                <span class="btn-label" id="action-label">Sell</span>
            </button>
            <button class="action-btn build-btn" style="margin-left:5px;" onclick="game.toggleShop()">
                <span class="btn-icon">🏠</span>
                <span class="btn-label">건설</span>
            </button>
            <button class="action-btn world-btn" style="margin-left:5px;" onclick="game.toggleField()">
                <span class="btn-icon">🌍</span>
                <span class="btn-label">필드</span>
            </button>
        </div>

        <!-- Modals -->
        <div id="field-modal">
            <div class="flex justify-between items-center px-3 py-2 border-b border-gray-600 bg-gray-900">
                <h2 class="text-lg font-bold text-yellow-400" id="modal-title">메뉴</h2>
                <button onclick="game.closeModal()" class="w-7 h-7 text-gray-400 font-bold text-sm">✖</button>
            </div>
            <div class="flex-1 overflow-auto bg-gray-800 p-2 relative" id="modal-content"></div>
        </div>

        <div id="modal-levelup" class="modal-overlay">
            <div class="modal-content">
                <h2 class="text-2xl font-bold text-yellow-400 mb-4">LEVEL UP!</h2>
                <div class="text-6xl mb-4">🆙</div>
                <div class="bg-gray-800 rounded p-4 mb-4 text-left text-sm">
                    <div class="levelup-stat">
                        <span>레벨 (Lord Level)</span>
                        <span><span id="lv-old" class="levelup-old">1</span> <span class="levelup-arrow">▶</span> <span
                                id="lv-new" class="levelup-new">2</span></span>
                    </div>
                    <div class="levelup-stat" style="border:none">
                        <span>최대 에너지</span>
                        <span><span id="en-old" class="levelup-old">50</span> <span class="levelup-arrow">▶</span> <span
                                id="en-new" class="levelup-new">52</span></span>
                    </div>
                </div>
                <button onclick="document.getElementById('modal-levelup').classList.remove('open')"
                    class="w-full bg-blue-600 hover:bg-blue-500 py-3 rounded-lg font-bold">확인</button>
            </div>
        </div>

        <div id="modal-refill" class="modal-overlay">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-white" id="refill-title">리소스 충전</h2>
                    <button onclick="document.getElementById('modal-refill').classList.remove('open')"
                        class="text-gray-400">✖</button>
                </div>
                <div id="refill-options" class="grid gap-3"></div>
            </div>
        </div>

        <div id="modal-settings" class="modal-overlay">
            <div class="modal-content">
                <h2 id="settings-title" class="text-xl font-bold text-gray-200 mb-6">설정 (Settings)</h2>
                <div class="space-y-4 text-left">
                    <div class="flex justify-between items-center bg-gray-800 p-3 rounded">
                        <span>배경음악 (BGM)</span>
                        <div class="toggle-switch on" onclick="game.toggleSetting('bgm', this)">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center bg-gray-800 p-3 rounded">
                        <span>효과음 (SFX)</span>
                        <div class="toggle-switch on" onclick="game.toggleSetting('sfx', this)">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center bg-gray-800 p-3 rounded">
                        <label id="locale-label" for="locale-select">언어 (Language)</label>
                        <select id="locale-select" onchange="game.setLocale(this.value)"
                            class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-xs text-gray-100">
                            <option value="ko">한국어</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="bg-gray-800 p-3 rounded text-xs text-gray-400">
                        <p>UID: <span id="settings-uid" class="text-gray-200">User_1234</span></p>
                        <p>Version: 0.3.3 (Hotfix: Data & Field Objects)</p>
                    </div>
                </div>
                <div class="mt-6 flex gap-2">
                    <button id="settings-reset-btn" onclick="game.resetGame()"
                        class="flex-1 bg-red-800 py-2 rounded text-xs text-red-200 border border-red-600 hover:bg-red-700">계정
                        초기화</button>
                    <button id="settings-close-btn" onclick="document.getElementById('modal-settings').classList.remove('open')"
                        class="flex-1 bg-gray-600 py-2 rounded text-xs border border-gray-500 hover:bg-gray-500">닫기</button>
                </div>
            </div>
        </div>

        <div id="modal-object" class="modal-overlay">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-white" id="object-modal-title">오브젝트</h2>
                    <button
                        onclick="document.getElementById('modal-object').classList.remove('open'); document.querySelector('#modal-object .modal-content')?.classList.remove('wide')"
                        class="text-gray-400">✖</button>
                </div>
                <div id="object-modal-body" class="text-left text-sm text-gray-200 space-y-2"></div>
                <button
                    onclick="document.getElementById('modal-object').classList.remove('open'); document.querySelector('#modal-object .modal-content')?.classList.remove('wide')"
                    class="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded text-xs border border-gray-600 mt-4">닫기</button>
            </div>
        </div>

        <div id="modal-battle" class="modal-overlay">
            <div class="modal-content">
                <div class="battle-header">
                    <h2 class="text-lg font-bold text-red-500">⚔ BATTLE</h2>
                    <div class="text-xs text-gray-400" id="battle-target-name">Target</div>
                </div>
                <div class="battle-container">
                    <div class="battle-stage" id="battle-stage">
                        <div class="flex gap-8 items-center">
                            <div class="flex flex-col items-center">
                                <span class="text-blue-400 font-bold text-xs mb-1">ALLIES</span>
                                <div class="battle-grid-check" id="battle-grid-ally"></div>
                            </div>
                            <div class="text-2xl font-bold text-gray-500">VS</div>
                            <div class="flex flex-col items-center">
                                <span class="text-red-400 font-bold text-xs mb-1">ENEMIES</span>
                                <div class="battle-grid-check" id="battle-grid-enemy"></div>
                            </div>
                        </div>
                        <div class="battle-result-overlay" id="battle-result-overlay">
                            <div class="battle-result-text" id="battle-result-title">VICTORY</div>
                            <button onclick="game.closeBattleModal()" class="battle-btn close">닫기</button>
                        </div>
                    </div>
                    <div class="battle-log" id="battle-log"></div>
                    <div class="battle-controls" id="battle-controls">
                        <button class="battle-btn close" onclick="game.closeBattleModal()">취소</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-battle-prep" class="modal-overlay">
            <div class="modal-content">
                <div class="battle-header">
                    <h2 class="text-lg font-bold text-yellow-400">전투 준비 (유닛 배치)</h2>
                    <div class="text-xs text-gray-400">드래그하여 위치를 변경하세요</div>
                </div>
                <div class="battle-container">
                    <div class="flex justify-around items-center w-full mb-4">
                        <div class="flex flex-col items-center">
                            <span class="text-blue-400 font-bold text-sm mb-2">아군 (Drag)</span>
                            <div class="battle-grid-check" id="prep-grid-ally"></div>
                        </div>
                        <div class="text-2xl font-bold text-gray-500">VS</div>
                        <div class="flex flex-col items-center">
                            <span class="text-red-400 font-bold text-sm mb-2">적군</span>
                            <div class="battle-grid-check" id="prep-grid-enemy"></div>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button class="battle-btn close"
                            onclick="this.closest('.modal-overlay').classList.remove('open'); this.closest('.modal-overlay').style.display='none'; game.closeBattlePrepModal()">취소</button>
                        <button class="battle-btn start"
                            onclick="this.closest('.modal-overlay').classList.remove('open'); this.closest('.modal-overlay').style.display='none'; game.confirmBattleStart()">전투
                            개시!</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="toast">메시지</div>
    </div>

    <script src="battle.js"></script>
    <script src="data_loader.js" data-game-script="game.js?v=25"></script>
</body>

</html>
